# 元数据性能评估

通过 [mdtest](https://github.com/LLNL/mdtest)
进行元数据性能测试的结果如下：

**工具设置**

``` bash
#!/bin/bash
TEST_PATH=/mnt/cfs/mdtest # mount point of CubeFS volume
for CLIENTS in 1 2 4 8 # number of clients
do
mpirun --allow-run-as-root -np $CLIENTS --hostfile hfile01 mdtest -n 5000 -u -z 2 -i 3 -d $TEST_PATH;
done
```

## 目录创建

![Dir Creation](../pic/cfs-mdtest-dir-creation.png)

|          | 1 进程   | 4 进程    | 16 进程   | 64 进程    |
|----------|----------|-----------|-----------|------------|
| 1 客户端 | 448.618  | 2421.001  | 14597.97  | 43055.15   |
| 2 客户端 | 956.947  | 5917.576  | 28930.431 | 72388.765  |
| 4 客户端 | 2027.02  | 13213.403 | 54449.056 | 104771.356 |
| 8 客户端 | 4643.755 | 27416.904 | 89641.301 | 119542.62  |

## 目录删除

![Dir Removal](../pic/cfs-mdtest-dir-removal.png)

|          | 1 进程   | 4 进程    | 16 进程   | 64 进程    |
|----------|----------|-----------|-----------|------------|
| 1 客户端 | 399.779  | 2118.005  | 12351.635 | 34903.672  |
| 2 客户端 | 833.353  | 5176.812  | 24471.674 | 50242.973  |
| 4 客户端 | 1853.617 | 11462.927 | 46413.313 | 91128.059  |
| 8 客户端 | 4441.435 | 24133.617 | 74401.336 | 115013.557 |

## 目录状态查看

![Dir Stat](../pic/cfs-mdtest-dir-stat.png)

|          | 1 进程      | 4 进程      | 16 进程     | 64 进程     |
|----------|-------------|-------------|-------------|-------------|
| 1 客户端 | 283232.761  | 1215309.524 | 4231088.104 | 12579177.02 |
| 2 客户端 | 572834.143  | 2169669.058 | 8362749.217 | 18120970.71 |
| 4 客户端 | 1263474.549 | 3333746.786 | 10160929.29 | 31874265.88 |
| 8 客户端 | 2258670.069 | 8715752.83  | 22524794.98 | 77533648.04 |

## 文件创建

![File Creation](../pic/cfs-mdtest-file-creation.png)

|          | 1 进程   | 4 进程    | 16 进程   | 64 进程    |
|----------|----------|-----------|-----------|------------|
| 1 客户端 | 448.888  | 2400.803  | 13638.072 | 27785.947  |
| 2 客户端 | 925.68   | 5664.166  | 25889.163 | 50434.484  |
| 4 客户端 | 2001.137 | 12986.968 | 50330.952 | 91387.825  |
| 8 客户端 | 4479.831 | 25933.437 | 86667.966 | 112746.199 |

## 文件删除

![File Removal](../pic/cfs-mdtest-file-removal.png)

|          | 1 进程   | 4 进程    | 16 进程   | 64 进程   |
|----------|----------|-----------|-----------|-----------|
| 1 客户端 | 605.143  | 3678.138  | 18631.342 | 47035.912 |
| 2 客户端 | 1301.151 | 8365.667  | 34005.25  | 64860.041 |
| 4 客户端 | 3032.683 | 14017.426 | 50938.926 | 80692.761 |
| 8 客户端 | 7170.386 | 32056.959 | 68761.908 | 88357.563 |

## Tree创建

![Tree Creation](../pic/cfs-mdtest-tree-creation.png)

|          | 1 进程  | 4 进程  | 16 进程 | 64 进程 |
|----------|---------|---------|---------|---------|
| 1 客户端 | 305.778 | 229.562 | 86.299  | 23.917  |
| 2 客户端 | 161.31  | 211.119 | 76.301  | 24.439  |
| 4 客户端 | 260.562 | 223.153 | 81.209  | 23.867  |
| 8 客户端 | 350.038 | 220.744 | 81.621  | 17.144  |

## Tree删除

![Tree Removal](../pic/cfs-mdtest-tree-removal.png)

|          | 1 进程  | 4 进程  | 16 进程 | 64 进程 |
|----------|---------|---------|---------|---------|
| 1 客户端 | 137.462 | 70.881  | 31.235  | 7.057   |
| 2 客户端 | 217.026 | 113.36  | 23.971  | 7.128   |
| 4 客户端 | 231.622 | 113.539 | 30.626  | 7.299   |
| 8 客户端 | 185.156 | 83.923  | 20.607  | 5.515   |